<!DOCTYPE html lang="en">
<html lang = "en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="./css/output.css" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
        <script type="text/javascript" src="js/code.js"></script>
        <script type="module" src="components/app-header.js"></script>
        <script type="text/javascript" src="components/contact-card.js"></script>
        <title> Home </title>

        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() 
            {
                checkLogin();
                document.getElementById("searchText").value = "";
                getContacts();
            }, false);
        </script>
    </head>

    <body>
        <app-header></app-header>
        <main class = "min-h-screen flex flex-col items-center">
            <!-- Filled in by checkLogin() -->
            <h1 class = "mt-5 text-3xl font-bold" id="firstName"></h1>
            <div class="flex flex-row items-end justify-center gap-3">
                <input id = "searchText" class = "mt-5 px-5 py-3 rounded-2xl" type = "text" placeholder="Search Contact"/>
                <button type="button" class="inline-flex justify-center items-center w-14 h-12 rounded-2xl hover:bg-white hover:text-yellow-400 transition-colors" onclick="searchContact();">
                    <!-- Icon -->
                    <span class="material-symbols-outlined">search</span>
                </button>
            </div>
            <span id="contactSearchResult" class="py-3 font-semibold"></span>
            <br /><br />

            <!-- Add Contact Button -->
            <button
            class="flex flex-row items-center justify-center rounded-md px-4 py-2 bg-yellow-400 text-md text-white font-bold hover:bg-white hover:text-yellow-400 transition"
            onclick="showAddDialog();"
            >
            <script>
                function showAddDialog() {
                    document.getElementById('addDialog').showModal();
                    requestAnimationFrame(() => {
                        document.getElementById('addDialog').classList.remove("opacity-0", "scale-80");
                    });
                }
            </script>
            <span class="material-symbols-outlined pr-2">add</span>
            Add contact
            </button>
            
            <!-- Contact List -->
             <div class="max-w-full mt-8" >
                <h1 class="text-4xl font-bold text-center" id="getContactsResult">
                    Your Contacts
                </h1>
                <div id="contactList" class="p-5 grid grid-cols-1 sm:grid-cols-2 gap-5 mt-3"></div>
             </div>
        </main>

        <!-- Add dialog -->
        <dialog id="addDialog" class="m-auto rounded-md px-3 border-none opacity-0 scale-80 transition-all duration-300 bg-transparent backdrop:bg-black/50 backdrop:backdrop-blur-sm">
            <div class="flex flex-col py-5 px-5 sm:px-10 justify-center items-center bg-[#2b2b2b] rounded-lg max-w-full w-lg">
                <h1 class="text-xl font-bold text-white pb-5">Add contact</h1>
                <input id="addFirstName" class="w-full mb-3 px-4 py-2 rounded-md" type="text" placeholder="First Name" oninput="validateAddForm();"/>
                <input id="addLastName" class="w-full mb-3 px-4 py-2 rounded-md" type="text" placeholder="Last Name" oninput="validateAddForm();"/>
                <input id="addEmail" class="w-full mb-3 px-4 py-2 rounded-md" type="text" placeholder="Email" oninput="validateAddForm();"/>
                <input id="addPhone" class="w-full mb-3 px-4 py-2 rounded-md" type="text" placeholder="Phone" oninput="validateAddForm();"/>
                <div class="flex flex-col gap-3 pt-3 w-full">
                    <button id="confirmAdd" class="w-full rounded-md px-4 py-2 bg-gray-400 cursor-not-allowed text-white font-bold transition-all" onclick="confirmAdd();" disabled>
                        Add Contact
                    </button>
                    <!-- Carries out add -->
                    <script>
                        function confirmAdd() {
                            document.getElementById('addDialog').classList.add("opacity-0", "scale-80");
                            // wait for animation before actually closing
                            setTimeout(() => {
                                document.getElementById('addDialog').close();
                            }, 300);
                            addContact();
                        }
                    </script>
                    <button id="cancelAdd" class="w-full rounded-md px-4 py-2 bg-red-600 text-white font-bold hover:bg-white hover:text-red-600 transition" onclick="closeAddDialog();">
                        Cancel
                    </button>
                    <script>
                        function closeAddDialog() {
                            document.getElementById('addDialog').classList.add("opacity-0", "scale-80");
                            // wait for animation before actually closing
                            setTimeout(() => {
                                document.getElementById('addDialog').close();
                            }, 300);
                        }
                    </script>
                    <!-- Validates all input fields, makes sure none is empty -->
                    <script>
                        function validateAddForm() {
                            const firstName = document.getElementById("addFirstName").value.trim();
                            const lastName = document.getElementById("addLastName").value.trim();
                            const email = document.getElementById("addEmail").value.trim();
                            const phone = document.getElementById("addPhone").value.trim();
                            const confirmButton = document.getElementById("confirmAdd");

                            if (firstName && lastName && email && phone) {
                                confirmButton.disabled = false;
                                confirmButton.classList.remove("bg-gray-400", "cursor-not-allowed");
                                confirmButton.classList.add("bg-green-600", "hover:bg-white", "hover:text-green-600");
                            } else {
                                confirmButton.disabled = true;
                                confirmButton.classList.remove("bg-green-600", "hover:bg-white", "hover:text-green-600");
                                confirmButton.classList.add("bg-gray-400", "cursor-not-allowed");
                            }
                        }
                    </script>
                </div>
            </div>
        </dialog>

        <!-- Successful deletion dialog -->
        <dialog id="deleteSuccessDialog" class="m-auto rounded-md px-3 border-none opacity-0 scale-80 transition-all duration-300 bg-transparent backdrop:bg-black/50 backdrop:backdrop-blur-sm">
            <div class="flex flex-col p-10 justify-center items-center bg-[#2b2b2b] rounded-lg text-center">
                <span class="material-symbols-outlined text-6xl! text-green-600 pb-5">check_circle</span>
                <h1 class="text-lg font-semibold text-white">Contact deleted successfully.</h1>
            </div>
        </dialog>

        <!-- Successful add dialog -->
        <dialog id="addSuccessDialog" class="m-auto rounded-md px-3 border-none opacity-0 scale-80 transition-all duration-300 bg-transparent backdrop:bg-black/50 backdrop:backdrop-blur-sm">
            <div class="flex flex-col p-10 justify-center items-center bg-[#2b2b2b] rounded-lg text-center">
                <span class="material-symbols-outlined text-6xl! text-green-600 pb-5">check_circle</span>
                <h1 class="text-lg font-semibold text-white">Contact added successfully.</h1>
            </div>
        </dialog>

        <!-- Successful edit dialog -->
        <dialog id="editSuccessDialog" class="m-auto rounded-md px-3 border-none opacity-0 scale-80 transition-all duration-300 bg-transparent backdrop:bg-black/50 backdrop:backdrop-blur-sm">
            <div class="flex flex-col p-10 justify-center items-center bg-[#2b2b2b] rounded-lg text-center">
                <span class="material-symbols-outlined text-6xl! text-green-600 pb-5">check_circle</span>
                <h1 class="text-lg font-semibold text-white">Edit successful.</h1>
            </div>
        </dialog>
    </body>
</html>